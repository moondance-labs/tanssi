name: Merge on ready
on:
  workflow_call:
    inputs:
      run_sha:
        description: "Sha commit from which artifacts are taken"
        required: true
  workflow_dispatch:
    inputs:
      run_sha:
        description: "Sha commit from which artifacts are taken"
        required: true

jobs:
    e2e-bridge-test:
        runs-on: self-hosted
        steps:
            - name: Checkout
              uses: actions/checkout@v4
              with:
                  ref: ${{ inputs.run_sha }}

            - name: Download build artifact from triggered workflow
              uses: dawidd6/action-download-artifact@v7
              with:
                commit: ${{ inputs.run_sha }}
                workflow: release.yml
                name: binaries
                path: target/release
                allow_forks: false
              
            - name: Run Zombienet Test ${{ matrix.test_name }}
              uses: ./.github/workflow-templates/bridge-e2e